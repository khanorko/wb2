"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[384],{8384:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var o=n(5155),r=n(2115),c=n(351);function l(e){let{id:t,x:n,y:l,content:s,color:a,timer:i,onDelete:u,onUpdate:d}=e,[f,g]=(0,r.useState)(!1),[E,p]=(0,r.useState)({x:n,y:l}),[m,x]=(0,r.useState)(i),[h,D]=(0,r.useState)(!1),[T,v]=(0,r.useState)(!1),N=(0,r.useRef)(null),w=(0,r.useRef)(null),_=(0,r.useRef)({x:0,y:0}),y=(0,r.useRef)({x:n,y:l});(0,r.useEffect)(()=>{y.current={x:n,y:l},p({x:n,y:l})},[n,l]),(0,r.useEffect)(()=>{if(m&&m>0){let e=setInterval(()=>{x(e=>{if(e&&e>0){let t=e-1;return 0===t&&u(),t}return e})},1e3);return()=>clearInterval(e)}},[m,u]);let k=(0,r.useCallback)(e=>{if(f&&N.current){let t=e.clientX-_.current.x,n=e.clientY-_.current.y;y.current={x:t,y:n},p({x:t,y:n}),console.log("Moving to position:",{newX:t,newY:n})}},[f]),O=(0,r.useCallback)(()=>{if(f){let e=y.current;console.log("Drag ended. Original position:",{x:n,y:l},"Final position:",e),Math.abs(e.x-n)>1||Math.abs(e.y-l)>1?(console.log("Position changed, sending update for note:",t),d({x:e.x,y:e.y})):console.log("Position unchanged, skipping update")}g(!1)},[f,n,l,t,d]);return(0,r.useEffect)(()=>{if(f)return window.addEventListener("mousemove",k),window.addEventListener("mouseup",O),()=>{window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",O)}},[f,k,O]),(0,r.useEffect)(()=>{let e=e=>{N.current&&!N.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,o.jsxs)("div",{ref:N,className:"absolute flex flex-col w-40 h-40 p-2 shadow-lg cursor-move transition-shadow ".concat(h?"shadow-xl":""),style:{transform:"translate(".concat(E.x,"px, ").concat(E.y,"px)"),backgroundColor:a,opacity:f?.8:1,zIndex:h?10:1},onMouseDown:e=>{var t;if(e.target instanceof HTMLTextAreaElement)return;g(!0),D(!0);let n=null==(t=N.current)?void 0:t.getBoundingClientRect();n&&(_.current={x:e.clientX-n.left,y:e.clientY-n.top}),e.preventDefault()},onClick:e=>{f||!w.current||e.target instanceof HTMLButtonElement||(D(!0),w.current.focus(),T||s?w.current.setSelectionRange(w.current.value.length,w.current.value.length):w.current.select())},children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,o.jsx)("div",{className:"text-xs font-medium",children:m?"".concat(m,"s"):""}),(0,o.jsx)("button",{className:"p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),u()},children:(0,o.jsx)(c.yGN,{className:"w-4 h-4"})})]}),(0,o.jsx)("textarea",{ref:w,className:"flex-1 w-full bg-transparent resize-none focus:outline-none",value:s,placeholder:T?"":"Enter text here",onChange:e=>{d({content:e.target.value}),v(!0)},onFocus:()=>D(!0)})]})}let s=(0,n(4298).Ay)("http://localhost:5001",{autoConnect:!0,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,transports:["polling","websocket"]});s.on("connect",()=>{console.log("Socket connected successfully")}),s.on("connect_error",e=>{console.error("Socket connection error:",e)}),s.on("disconnect",e=>{console.log("Socket disconnected:",e),"io server disconnect"===e&&s.connect()});let a={INIT_NOTES:"init-notes",ADD_NOTE:"add-note",NOTE_ADDED:"note-added",UPDATE_NOTE:"update-note",NOTE_UPDATED:"note-updated",DELETE_NOTE:"delete-note",NOTE_DELETED:"note-deleted"},i=(0,r.forwardRef)((e,t)=>{let[n,c]=(0,r.useState)([]),[i,u]=(0,r.useState)(100),d=(0,r.useRef)(null),f=(e,t)=>{console.log("Adding note at:",e,t);let n={id:Date.now().toString(),x:e,y:t,content:"",color:m(),timer:20};console.log("Emitting new note:",n),s.emit(a.ADD_NOTE,n)},g=e=>{u(e)};(0,r.useImperativeHandle)(t,()=>({handleAddNote:f,getCurrentView:()=>d.current?{x:d.current.scrollLeft,y:d.current.scrollTop}:{x:0,y:0},handleZoom:g})),(0,r.useEffect)(()=>{console.log("Setting up socket listeners"),s.on("connect",()=>{console.log("Socket connected")}),s.on("connect_error",e=>{console.error("Socket connection error:",e)}),s.on(a.INIT_NOTES,e=>{console.log("Received initial notes:",e),c(e)}),s.on(a.NOTE_ADDED,e=>{console.log("Note added:",e),c(t=>[...t,e])}),s.on(a.NOTE_UPDATED,e=>{console.log("Note updated:",e),c(t=>t.map(t=>t.id===e.id?e:t))}),s.on(a.NOTE_DELETED,e=>{console.log("Note deleted:",e),c(t=>t.filter(t=>t.id!==e))});let e=new URLSearchParams(window.location.search),t=parseInt(e.get("x")||"0"),n=parseInt(e.get("y")||"0");return d.current&&(t||n)&&d.current.scrollTo(t,n),()=>{console.log("Cleaning up socket listeners"),s.off("connect"),s.off("connect_error"),s.off(a.INIT_NOTES),s.off(a.NOTE_ADDED),s.off(a.NOTE_UPDATED),s.off(a.NOTE_DELETED)}},[]);let E=e=>{console.log("Deleting note:",e),s.emit(a.DELETE_NOTE,e)},p=(e,t)=>{console.log("Updating note:",e,t),s.emit(a.UPDATE_NOTE,{id:e,...t})},m=()=>{let e=["#FFB3B3","#B3FFB3","#B3B3FF","#FFE4B3"];return e[Math.floor(Math.random()*e.length)]};return(0,o.jsx)("div",{ref:d,className:"relative w-full h-screen overflow-auto bg-white",style:{backgroundImage:"linear-gradient(#ddd 1px, transparent 1px), linear-gradient(90deg, #ddd 1px, transparent 1px)",backgroundSize:"".concat(i/100*20,"px ").concat(i/100*20,"px"),width:"200vw",height:"200vh",transform:"scale(".concat(i/100,")"),transformOrigin:"0 0"},children:n.map(e=>(0,o.jsx)(l,{...e,onDelete:()=>E(e.id),onUpdate:t=>p(e.id,t)},e.id))})});i.displayName="Whiteboard";let u=i}}]);